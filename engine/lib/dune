(library
 (public_name hax-engine)
 (name hax_engine)
 (libraries
  yojson
  non_empty_list
  pprint
  ppx_deriving_yojson.runtime
  cmdliner
  fstar_surface_ast
  base
  core
  re)
 (preprocessor_deps
  ; `ppx_inline` is used on the `Subtype` module, thus we need it at PPX time
  (file subtype.ml))
 (preprocess
  (pps
   ppx_yojson_conv
   ppx_sexp_conv
   ppx_compare
   ppx_hash
   visitors.ppx
   ppx_deriving.show
   ppx_deriving.eq
   ppx_string
   ppx_inline
   ppx_generate_features
   ppx_functor_application
   ppx_matches)))

(include_subdirs unqualified)

(rule
 (target raw_thir_ast.ml)
 (deps
  (env_var HAX_JSON_SCHEMA_EXPORTER_BINARY)
  (:ocaml_of_json_schema
   ../utils/ocaml_of_json_schema/ocaml_of_json_schema.js))
 (action
  (with-stdout-to
   raw_thir_ast.ml
   (pipe-stdout
    (run %{env:HAX_JSON_SCHEMA_EXPORTER_BINARY=hax-export-json-schemas})
    (run node %{ocaml_of_json_schema} - -)))))

(env
 (_
  (flags
   (:standard -g -warn-error "-A+8" -w "-17-7-30-56-32"))))
